# –î–æ—Å—Ç—É–ø –∫ —Å–∫–ª–∞–¥–∞–º (Omborlar)

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### üîê –ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–∫–ª–∞–¥–∞–º–∏?

#### ‚úÖ –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω (Super Admin)
- **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–∫–ª–∞–¥–∞–º–∏
- –ú–æ–∂–µ—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —Å–∫–ª–∞–¥—ã (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–∫–ª–∞–¥—ã
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫–ª–∞–¥—ã
  - –£–¥–∞–ª—è—Ç—å —Å–∫–ª–∞–¥—ã
  - –£–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä–∞–º–∏ —Å–∫–ª–∞–¥–æ–≤
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å Telegram –±–æ—Ç—ã –¥–ª—è —Å–∫–ª–∞–¥–æ–≤
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∫–ª–∞–¥–æ–≤

**–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞: `/admin/restaurants`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `/admin/restaurants/[id]`

**RLS –ø–æ–ª–∏—Ç–∏–∫–∞:**
```sql
CREATE POLICY "Super admin can manage restaurants"
  ON restaurants FOR ALL
  USING (is_super_admin());
```

---

#### ‚ùå –ú–µ–Ω–µ–¥–∂–µ—Ä—ã (Managers)
- **–ù–ï–¢ –¥–æ—Å—Ç—É–ø–∞** –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å–∫–ª–∞–¥–æ–≤
- –ù–µ –º–æ–≥—É—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
  - –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–ª–∞–¥—ã
  - –£–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä–∞–º–∏ —Å–∫–ª–∞–¥–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–ü–æ—á–µ–º—É –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/restaurants` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å `super_admin`:
  ```typescript
  if (!profile || profile.role !== 'super_admin') {
    redirect('/')
  }
  ```
- –í RLS –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º

**–ß—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å:**
- –£–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–∫–∞–∑–∞–º–∏ (`/manager/orders`)
- –ù–∞–∑–Ω–∞—á–∞—Ç—å —Å–±–æ—Ä—â–∏–∫–æ–≤ –∏ –∫—É—Ä—å–µ—Ä–æ–≤
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ —Å–±–æ—Ä—â–∏–∫–æ–≤ –∏ –∫—É—Ä—å–µ—Ä–æ–≤

---

#### üëÅÔ∏è –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ (–ö–ª–∏–µ–Ω—Ç—ã, –°–±–æ—Ä—â–∏–∫–∏, –ö—É—Ä—å–µ—Ä—ã)
- **–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä** –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ú–æ–≥—É—Ç:
  - –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (`/`)
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤
  - –û—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑—ã

**RLS –ø–æ–ª–∏—Ç–∏–∫–∞:**
```sql
CREATE POLICY "Anyone can view active restaurants"
  ON restaurants FOR SELECT
  USING (is_active = true);
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –í–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–∫–ª–∞–¥—ã —Å `is_active = true`
- –ù–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∫–ª–∞–¥—ã
- –ù–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞

| –†–æ–ª—å | –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤ | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞–º–∏ | –°–æ–∑–¥–∞–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –£–¥–∞–ª–µ–Ω–∏–µ |
|------|---------------------------|---------------------|-------------------------|----------|
| –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω | ‚úÖ –í—Å–µ (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ) | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –ú–µ–Ω–µ–¥–∂–µ—Ä | ‚úÖ –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–π) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –°–±–æ—Ä—â–∏–∫ | ‚úÖ –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–π) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –ö—É—Ä—å–µ—Ä | ‚úÖ –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–π) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –ö–ª–∏–µ–Ω—Ç | ‚úÖ –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–π) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | ‚úÖ –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–π) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |

---

## –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –¥–æ—Å—Ç—É–ø –∫ —Å–∫–ª–∞–¥–∞–º

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –º–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥–ª–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–∫–ª–∞–¥–∞–º–∏, –Ω—É–∂–Ω–æ:

1. **–û–±–Ω–æ–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –≤ Supabase:
   ```sql
   -- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
   CREATE POLICY "Managers can manage restaurants"
     ON restaurants FOR ALL
     USING (
       EXISTS (
         SELECT 1 FROM profiles
         WHERE profiles.id = auth.uid()
         AND profiles.role = 'manager'
       )
     );
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞** –≤ `app/admin/restaurants/page.tsx`:
   ```typescript
   if (!profile || (profile.role !== 'super_admin' && profile.role !== 'manager')) {
     redirect('/')
   }
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞** –≤ `app/admin/restaurants/[id]/page.tsx`:
   ```typescript
   if (!profile || (profile.role !== 'super_admin' && profile.role !== 'manager')) {
     redirect('/')
   }
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é** –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ `components/common/Navbar.tsx`:
   ```typescript
   case 'manager':
     return [
       { href: '/manager/dashboard', label: 'Boshqaruv paneli' },
       { href: '/manager/orders', label: 'Buyurtmalar' },
       { href: '/admin/restaurants', label: 'Omborlar' }, // –î–æ–±–∞–≤–∏—Ç—å
     ]
   ```

---

## –¢–µ–∫—É—â–∏–µ —Ñ–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–∫–ª–∞–¥–∞–º

1. **RLS –ø–æ–ª–∏—Ç–∏–∫–∏:**
   - `supabase/02_rls_policies.sql` (—Å—Ç—Ä–æ–∫–∏ 67-79)
   - `supabase/02_rls_policies_safe.sql` (—Å—Ç—Ä–æ–∫–∏ 69-81)

2. **–°—Ç—Ä–∞–Ω–∏—Ü—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:**
   - `app/admin/restaurants/page.tsx` - —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤
   - `app/admin/restaurants/[id]/page.tsx` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞
   - `app/admin/restaurants/new/page.tsx` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞

3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - `components/admin/RestaurantsList.tsx` - —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤
   - `components/admin/RestaurantTabs.tsx` - –≤–∫–ª–∞–¥–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∫–ª–∞–¥—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –¢–æ–ª—å–∫–æ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–∫–ª–∞–¥–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–∫–ª–∞–¥–∞–º–∏
- –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞–∫ RLS –ø–æ–ª–∏—Ç–∏–∫–∏, —Ç–∞–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–¥–µ

